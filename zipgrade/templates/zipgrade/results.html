{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans 'ZipGrade Results' %} - AIMS EXAM{% endblock %}

{% block content %}
<div class='topbar'>
    <h1 class='topbar-title'>{% trans 'ZipGrade Results' %}</h1>
    <div class='topbar-actions'>
        <a href='{% url "zipgrade:upload" %}' class='btn btn-primary'>
            <svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none'
                stroke='currentColor' stroke-width='2'>
                <path d='M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'></path>
                <polyline points='17 8 12 3 7 8'></polyline>
                <line x1='12' y1='3' x2='12' y2='15'></line>
            </svg>
            {% trans 'Upload New' %}
        </a>
    </div>
</div>

{% include 'partials/messages.html' %}

<div class='card' style='margin-bottom: var(--spacing-xl);'>
    <form method='get' style='display: flex; flex-wrap: wrap; gap: var(--spacing-md); align-items: flex-end;'>

        <div class='form-group' style='margin-bottom: 0; flex: 1; min-width: 200px;'>
            <label class='form-label'>{% trans 'Search' %}</label>
            <input type='text' name='search' value='{{ search }}' class='form-input'
                placeholder='{% trans "Search exams..." %}'>
        </div>

        <div class='form-group' style='margin-bottom: 0; min-width: 150px;'>
            <label class='form-label'>{% trans 'From Date' %}</label>
            <input type='date' name='date_from' value='{{ date_from|default:"" }}' class='form-input'>
        </div>

        <div class='form-group' style='margin-bottom: 0; min-width: 150px;'>
            <label class='form-label'>{% trans 'To Date' %}</label>
            <input type='date' name='date_to' value='{{ date_to|default:"" }}' class='form-input'>
        </div>

        <div class='form-group' style='margin-bottom: 0; min-width: 200px;'>
            <label class='form-label'>{% trans 'School' %}</label>
            <select name='school' class='form-select'>
                <option value=''>{% trans 'All Schools' %}</option>
                {% for school in schools %}
                <option value="{{ school.pk }}" {% if school_filter|add:"0" == school.pk %}selected{% endif %}>
                    {{ school.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <button type='submit' class='btn btn-secondary'>{% trans 'Filter' %}</button>
        <a href='{% url "zipgrade:results" %}' class='btn btn-outline'>{% trans 'Clear' %}</a>
    </form>
</div>

<div class='card'>
    <div class='table-container'>
        <table class='table'>
            <thead>
                <tr>
                    <th>{% trans 'Exam' %}</th>
                    <th>{% trans 'School' %}</th>
                    <th>{% trans 'Date' %}</th>
                    <th>{% trans 'Students' %}</th>
                    <th>{% trans 'Unknown' %}</th>
                    <th>{% trans 'Avg Score' %}</th>
                    <th style='width: 140px;'></th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exams %}
                <tr>
                    <td>
                        <a href='{% url "zipgrade:exam_detail" exam.pk %}' style='font-weight: 500;'>
                            {{ exam.title }}
                        </a>
                        <div class='text-muted' style='font-size: 0.75rem;'>
                            {{ exam.total_questions }} {% trans 'questions' %}
                        </div>
                    </td>
                    <td>{{ exam.school.name }}</td>
                    <td>{{ exam.exam_date|date:'M d, Y' }}</td>
                    <td>{{ exam.total_students }}</td>
                    <td>
                        {% if exam.unknown_students > 0 %}
                        <span class='badge badge-warning'>{{ exam.unknown_students }}</span>
                        {% else %}
                        <span class='text-muted'>0</span>
                        {% endif %}
                    </td>
                    <td>
                        <strong style="color:
                            {% if exam.average_score >= 70 %}var(--success)
                            {% elif exam.average_score >= 50 %}var(--warning)
                            {% else %}var(--danger)
                            {% endif %}">
                            {{ exam.average_score }}%
                        </strong>
                    </td>
                    <td>
                        <div style='display: flex; gap: 8px;'>
                            <a href='{% url "zipgrade:exam_detail" exam.pk %}' class='btn btn-sm btn-outline'>
                                {% trans 'View' %}
                            </a>
                            <a href='{% url "zipgrade:exam_delete" exam.pk %}' class='btn btn-sm btn-outline'
                                style='color: var(--danger); border-color: var(--danger);' title='{% trans "Delete" %}'>
                                ðŸ—‘
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan='7' style='text-align: center; color: var(--text-muted); padding: var(--spacing-xl);'>
                        {% trans 'No exams uploaded yet.' %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if exams.has_other_pages %}
    <div style='display: flex; justify-content: center; margin -top: var(--spacing-lg);'>
        <div class='pagination'>
            {% if exams.has_previous %}
            <a href='?page={{ exams.previous_page_number }}&search={{ search }}&school={{ school_filter }}'
                class='pagination-btn'></a>
            {% endif %}
            <span class='pagination-info'>
                {% trans 'Page' %} {{ exams.number }} {% trans 'of' %} {{ exams.paginator.num_pages }}
            </span>
            {% if exams.has_next %}
            <a href='?page={{ exams.next_page_number }}&search={{ search }}&school={{ school_filter }}'
                class='pagination-btn'>â€º</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}